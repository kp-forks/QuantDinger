"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[613],{53003:function(e,t,a){a.d(t,{DZ:function(){return r},YT:function(){return n},_d:function(){return l},lo:function(){return i}});a(76338);var s=a(75769);function i(){return(0,s.Ay)({url:"/api/settings/schema",method:"get"})}function n(){return(0,s.Ay)({url:"/api/settings/values",method:"get"})}function r(e){return(0,s.Ay)({url:"/api/settings/save",method:"post",data:e})}function l(){return(0,s.Ay)({url:"/api/settings/openrouter-balance",method:"get"})}},64613:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});a(52675),a(89463),a(28706),a(50778);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"settings-page",class:{"theme-dark":e.isDarkTheme}},[e.showRestartTip?t("a-alert",{staticClass:"restart-alert",attrs:{type:"warning",showIcon:"",closable:""},on:{close:function(t){e.showRestartTip=!1}}},[t("template",{slot:"message"},[t("span",[e._v(e._s(e.$t("settings.restartRequired")))]),t("a-button",{attrs:{size:"small",type:"link"},on:{click:e.copyRestartCommand}},[e._v(" "+e._s(e.$t("settings.copyRestartCmd"))+" ")])],1)],2):e._e(),t("div",{staticClass:"settings-header"},[t("h2",{staticClass:"page-title"},[t("a-icon",{attrs:{type:"setting"}}),t("span",[e._v(e._s(e.$t("settings.title")))])],1),t("p",{staticClass:"page-desc"},[e._v(e._s(e.$t("settings.description")))])]),t("a-spin",{attrs:{spinning:e.loading}},[t("div",{staticClass:"settings-content"},[t("a-collapse",{staticClass:"settings-collapse",attrs:{bordered:!1},model:{value:e.activeKeys,callback:function(t){e.activeKeys=t},expression:"activeKeys"}},e._l(e.sortedSchema,function(a,s){return t("a-collapse-panel",{key:s},[t("template",{slot:"header"},[t("span",{staticClass:"panel-header"},[t("a-icon",{staticClass:"panel-icon-left",attrs:{type:a.icon||e.getGroupIcon(s)}}),t("span",{staticClass:"panel-title"},[e._v(e._s(e.getGroupTitle(s,a.title)))])],1)]),"ai"===s?t("div",{staticClass:"openrouter-balance-card"},[t("a-card",{attrs:{size:"small",bordered:!1}},[t("div",{staticClass:"balance-header"},[t("span",{staticClass:"balance-title"},[t("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"wallet"}}),e._v(" "+e._s(e.$t("settings.openrouterBalance")||"OpenRouter 账户余额")+" ")],1),t("a-button",{attrs:{size:"small",type:"primary",ghost:"",loading:e.balanceLoading},on:{click:e.queryOpenRouterBalance}},[t("a-icon",{attrs:{type:"sync"}}),e._v(" "+e._s(e.$t("settings.queryBalance")||"查询余额")+" ")],1)],1),e.openrouterBalance?t("div",{staticClass:"balance-info"},[t("a-row",{attrs:{gutter:16}},[t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:e.$t("settings.balanceUsage")||"已使用",value:e.openrouterBalance.usage,prefix:"$",precision:4,"value-style":{color:"#cf1322"}}})],1),t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:e.$t("settings.balanceRemaining")||"剩余额度",value:null!==e.openrouterBalance.limit_remaining?e.openrouterBalance.limit_remaining:"∞",prefix:null!==e.openrouterBalance.limit_remaining?"$":"",precision:null!==e.openrouterBalance.limit_remaining?4:0,"value-style":{color:null!==e.openrouterBalance.limit_remaining&&e.openrouterBalance.limit_remaining<1?"#cf1322":"#3f8600"}}})],1),t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:e.$t("settings.balanceLimit")||"总限额",value:null!==e.openrouterBalance.limit?e.openrouterBalance.limit:"∞",prefix:null!==e.openrouterBalance.limit?"$":"",precision:null!==e.openrouterBalance.limit?2:0}})],1)],1),e.openrouterBalance.is_free_tier?t("div",{staticClass:"free-tier-badge"},[t("a-tag",{attrs:{color:"blue"}},[e._v("Free Tier")])],1):e._e()],1):t("div",{staticClass:"balance-empty"},[t("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"info-circle"}}),e._v(" "+e._s(e.$t("settings.balanceNotQueried")||'点击"查询余额"获取账户信息')+" ")],1)])],1):e._e(),t("a-form",{staticClass:"settings-form",attrs:{form:e.form,layout:"vertical"}},[t("a-row",{attrs:{gutter:24}},e._l(a.items,function(a){return t("a-col",{key:a.key,attrs:{xs:24,sm:24,md:12,lg:12}},[t("a-form-item",[t("template",{slot:"label"},[t("span",{staticClass:"form-label-with-tooltip"},[t("span",{staticClass:"label-text"},[e._v(e._s(e.getItemLabel(s,a)))]),a.description?t("a-tooltip",{attrs:{placement:"top"}},[t("template",{slot:"title"},[e._v(" "+e._s(e.getItemDescription(s,a))+" ")]),t("a-icon",{staticClass:"help-icon",attrs:{type:"question-circle"}})],2):e._e(),a.link?t("a",{staticClass:"api-link",attrs:{href:a.link,target:"_blank",rel:"noopener noreferrer"},on:{click:function(e){e.stopPropagation()}}},[t("a-icon",{attrs:{type:"link"}}),e._v(" "+e._s(e.getLinkText(a.link_text))+" ")],1):e._e()],1)]),"text"===a.type?[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[a.key,{initialValue:e.getFieldValue(s,a.key)}],expression:"[item.key, { initialValue: getFieldValue(groupKey, item.key) }]"}],attrs:{placeholder:a.default?"".concat(e.$t("settings.default"),": ").concat(a.default):"",allowClear:""}})]:"password"===a.type?[t("div",{staticClass:"password-field"},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[a.key,{initialValue:e.getFieldValue(s,a.key)}],expression:"[item.key, { initialValue: getFieldValue(groupKey, item.key) }]"}],attrs:{type:e.passwordVisible[a.key]?"text":"password",placeholder:e.$t("settings.inputApiKey"),allowClear:""}},[t("a-icon",{staticStyle:{cursor:"pointer"},attrs:{slot:"suffix",type:e.passwordVisible[a.key]?"eye":"eye-invisible"},on:{click:function(t){return e.togglePasswordVisible(a.key)}},slot:"suffix"})],1)],1)]:"number"===a.type?[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:[a.key,{initialValue:e.getNumberValue(s,a.key,a.default)}],expression:"[item.key, { initialValue: getNumberValue(groupKey, item.key, item.default) }]"}],staticStyle:{width:"100%"},attrs:{placeholder:a.default?"".concat(e.$t("settings.default"),": ").concat(a.default):""}})]:"boolean"===a.type?[t("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:[a.key,{valuePropName:"checked",initialValue:e.getBoolValue(s,a.key,a.default)}],expression:"[item.key, { valuePropName: 'checked', initialValue: getBoolValue(groupKey, item.key, item.default) }]"}]})]:"select"===a.type?[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:[a.key,{initialValue:e.getFieldValue(s,a.key)||a.default}],expression:"[item.key, { initialValue: getFieldValue(groupKey, item.key) || item.default }]"}],attrs:{placeholder:a.default?"".concat(e.$t("settings.default"),": ").concat(a.default):e.$t("settings.pleaseSelect")}},e._l(e.getSelectOptions(a.options),function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(" "+e._s(a.label)+" ")])}),1)]:e._e(),a.default&&"boolean"!==a.type&&"password"!==a.type?t("div",{staticClass:"field-default"},[e._v(" "+e._s(e.$t("settings.default"))+": "+e._s(a.default)+" ")]):e._e()],2)],1)}),1)],1)],2)}),1)],1)]),t("div",{staticClass:"settings-footer"},[t("a-button",{attrs:{disabled:e.saving},on:{click:e.handleReset}},[t("a-icon",{attrs:{type:"undo"}}),e._v(" "+e._s(e.$t("settings.reset"))+" ")],1),t("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:e.handleSave}},[t("a-icon",{attrs:{type:"save"}}),e._v(" "+e._s(e.$t("settings.save"))+" ")],1)],1)],1)},i=[],n=a(57532),r=a(81127),l=a(56252),o=a(44735),c=a(15863),u=(a(2008),a(62062),a(26910),a(5506),a(79432),a(26099),a(47764),a(11392),a(62953),a(53003)),p=a(55434),d={name:"Settings",mixins:[p.t],data:function(){return{loading:!1,saving:!1,schema:{},values:{},activeKeys:["auth","ai","trading"],passwordVisible:{},showRestartTip:!1,balanceLoading:!1,openrouterBalance:null}},computed:{isDarkTheme:function(){return"dark"===this.navTheme||"realdark"===this.navTheme},sortedSchema:function(){var e=Object.entries(this.schema);e.sort(function(e,t){var a=e[1].order||999,s=t[1].order||999;return a-s});for(var t={},a=0,s=e;a<s.length;a++){var i=(0,c.A)(s[a],2),n=i[0],r=i[1];t[n]=r}return t}},beforeCreate:function(){this.form=this.$form.createForm(this)},mounted:function(){this.loadSettings()},methods:{getSelectOptions:function(e){var t=Array.isArray(e)?e:[];return t.map(function(e){return e&&"object"===(0,o.A)(e)?{value:null!=e.value?String(e.value):"",label:null!=e.label?String(e.label):String(e.value||"")}:{value:String(e),label:String(e)}}).filter(function(e){return""!==e.value})},loadSettings:function(){var e=this;return(0,l.A)((0,r.A)().m(function t(){var a,s,i,n;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.loading=!0,t.p=1,t.n=2,Promise.all([(0,u.lo)(),(0,u.YT)()]);case 2:a=t.v,s=(0,c.A)(a,2),i=s[0],n=s[1],1===i.code&&(e.schema=i.data),1===n.code&&(e.values=n.data),t.n=4;break;case 3:t.p=3,t.v,e.$message.error(e.$t("settings.loadFailed"));case 4:return t.p=4,e.loading=!1,t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}))()},queryOpenRouterBalance:function(){var e=this;return(0,l.A)((0,r.A)().m(function t(){var a;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.balanceLoading=!0,t.p=1,t.n=2,(0,u._d)();case 2:a=t.v,1===a.code&&a.data?(e.openrouterBalance=a.data,e.$message.success(e.$t("settings.balanceQuerySuccess")||"余额查询成功")):e.$message.error(a.msg||e.$t("settings.balanceQueryFailed")||"余额查询失败"),t.n=4;break;case 3:t.p=3,t.v,e.$message.error(e.$t("settings.balanceQueryFailed")||"余额查询失败");case 4:return t.p=4,e.balanceLoading=!1,t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}))()},getGroupIcon:function(e){var t={auth:"lock",email:"mail",sms:"phone",network:"global",app:"appstore",ai:"robot",trading:"stock",data_source:"database",search:"search",agent:"experiment",security:"safety",billing:"dollar"};return t[e]||"setting"},getGroupTitle:function(e,t){var a="settings.group.".concat(e),s=this.$t(a);return s!==a?s:t},getItemLabel:function(e,t){var a="settings.field.".concat(t.key),s=this.$t(a);return s!==a?s:t.label},getItemDescription:function(e,t){var a="settings.desc.".concat(t.key),s=this.$t(a);return s!==a?s:t.description||""},getLinkText:function(e){if(!e)return this.$t("settings.getApi");if(e.startsWith("settings.link.")){var t=this.$t(e);return t!==e?t:e}return e},getFieldValue:function(e,t){var a=this.values[e]||{};return a[t]||""},togglePasswordVisible:function(e){this.$set(this.passwordVisible,e,!this.passwordVisible[e])},getNumberValue:function(e,t,a){var s=this.getFieldValue(e,t);return""===s||null===s||void 0===s?a?parseFloat(a):null:parseFloat(s)},getBoolValue:function(e,t,a){var s=this.getFieldValue(e,t);return""===s||null===s||void 0===s?"True"===a||"true"===a||!0===a:"True"===s||"true"===s||!0===s},handleReset:function(){this.form.resetFields(),this.loadSettings()},copyRestartCommand:function(){var e=this,t="cd backend_api_python && py run.py";navigator.clipboard.writeText(t).then(function(){e.$message.success(e.$t("settings.copySuccess"))}).catch(function(){e.$message.error(e.$t("settings.copyFailed"))})},handleSave:function(){var e=this;return(0,l.A)((0,r.A)().m(function t(){return(0,r.A)().w(function(t){while(1)switch(t.n){case 0:e.form.validateFields(function(){var t=(0,l.A)((0,r.A)().m(function t(a,s){var i,l,o,c,p,d,g,m,f,v,y;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:if(!a){t.n=1;break}return t.a(2);case 1:for(e.saving=!0,t.p=2,i={},l=0,o=Object.keys(e.schema);l<o.length;l++){c=o[l],i[c]={},p=e.schema[c],d=(0,n.A)(p.items);try{for(d.s();!(g=d.n()).done;)m=g.value,m.key in s&&(f=s[m.key],"boolean"===m.type&&(f=f?"True":"False"),i[c][m.key]=f)}catch(a){d.e(a)}finally{d.f()}}return t.n=3,(0,u.DZ)(i);case 3:v=t.v,1===v.code?(e.$message.success(v.msg||e.$t("settings.saveSuccess")),v.data&&v.data.requires_restart&&(e.showRestartTip=!0),e.loadSettings()):e.$message.error(v.msg||e.$t("settings.saveFailed")),t.n=5;break;case 4:t.p=4,y=t.v,e.$message.error(e.$t("settings.saveFailed")+": "+y.message);case 5:return t.p=5,e.saving=!1,t.f(5);case 6:return t.a(2)}},t,null,[[2,4,5,6]])}));return function(e,a){return t.apply(this,arguments)}}());case 1:return t.a(2)}},t)}))()}}},g=d,m=a(81656),f=(0,m.A)(g,s,i,!1,null,"20857e25",null),v=f.exports}}]);